<div class="viewer-container">
  <div *ngIf="isLoading" class="loading-indicator">
    Carregando documento...
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <div *ngIf="!isLoading && document" class="document-content">
    <h2>{{ document.title || document.originalFilename }}</h2>
    <p *ngIf="document.description">{{ document.description }}</p>

    <div class="viewer-actions top-actions">
      <button (click)="downloadCurrentDocument()" [disabled]="!pdfSrc">Baixar PDF</button>
      <!-- Add other actions like cancel flow if applicable -->
    </div>

    <div class="pdf-viewer-area">
      <pdf-viewer
        [src]="pdfSrc"
        [render-text]="true"
        [original-size]="false"
        style="display: block; width: 100%; height: 600px; border: 1px solid #ccc;"
        (error)="errorMessage = \'Erro ao carregar o PDF.\'"
      ></pdf-viewer>
    </div>

    <div class="signature-flow">
      <h3>Fluxo de Assinatura</h3>
      <div *ngIf="!document.signatories || document.signatories.length === 0">
        Nenhum signatário definido.
      </div>
      <ul *ngIf="document.signatories && document.signatories.length > 0">
        <!-- Order signatories by order -->
        <li *ngFor="let signatory of document.signatories | orderBy:
        \"order\":\"asc\"" [ngClass]="{
            \"pending\": signatory.status === \"PENDING\",
            \"signed\": signatory.status === \"SIGNED\",
            \"rejected\": signatory.status === \"REJECTED\"
          }">
          <span class="order">{{ signatory.order }}.</span>
          <span class="name">{{ signatory.name || signatory.email || (\"Usuário ID: \" + signatory.userId) }}</span>
          <span class="status">({{ signatory.status }})</span>
          <span *ngIf="signatory.signedAt" class="timestamp"> - {{ signatory.signedAt | date:
          \"dd/MM/yyyy HH:mm\":\"UTC\" }}</span>
          <span *ngIf="signatory.status === \"REJECTED\" && signatory.rejectionReason" class="reason"> - Motivo: {{ signatory.rejectionReason }}</span>
        </li>
      </ul>
    </div>

    <div *ngIf="isUserNextSignatory" class="viewer-actions sign-action">
      <p>É a sua vez de assinar este documento.</p>
      <button (click)="signDocument()" [disabled]="isLoading">Assinar Agora</button>
      <!-- Add reject button if needed -->
    </div>

    <div *ngIf="signActionRequested && isUserNextSignatory && !isLoading">
      <!-- Automatically trigger sign action if requested via query param -->
      {{ signDocument() }} <!-- This is a bit hacky, consider a better way -->
    </div>

  </div>
</div>

